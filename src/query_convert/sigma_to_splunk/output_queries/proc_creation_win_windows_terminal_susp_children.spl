index=* sourcetype="WinEventLog:Security" EventCode=4688
 | search ((Parent_Process_Name="*\WindowsTerminal.exe" OR Parent_Process_Name="*\wt.exe")) | search (New_Process_Name="*['\\rundll32.exe', '\\regsvr32.exe', '\\certutil.exe', '\\cscript.exe', '\\wscript.exe', '\\csc.exe']" OR New_Process_Name="*['C:\\Users\\Public\\', '\\Downloads\\', '\\Desktop\\', '\\AppData\\Local\\Temp\\', '\\Windows\\TEMP\\']*" OR Process_Command_Line="*[' iex ', ' icm', 'Invoke-', 'Import-Module ', 'ipmo ', 'DownloadString(', ' /c ', ' /k ', ' /r ']*") | search ((Process_Command_Line="Import-Module" OR Process_Command_Line="Microsoft.VisualStudio.DevShell.dll" OR Process_Command_Line="Enter-VsDevShell")) | search ((Process_Command_Line="\AppData\Local\Packages\Microsoft.WindowsTerminal_" OR Process_Command_Line="\LocalState\settings.json")) | search ((Process_Command_Line="C:\Program Files\Microsoft Visual Studio\" OR Process_Command_Line="\Common7\Tools\VsDevCmd.bat"))
| table _time, New_Process_Name, Process_Command_Line